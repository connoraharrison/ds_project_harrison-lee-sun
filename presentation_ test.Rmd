---
title: "Predicting job mismatch through analyzing overall job satisfaction"
author: "Harri-Lee-Sun"
date: "2019/4/27"
output:
  ioslides_presentation:
    incremental: yes
    widescreen: yes
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Problem statement and background

- The cost of higher education has increased but incomes hasn't

- Student debt has also increased significantly

- Student loan debt in 2018: $1.5 trillion

- Graduating class of 2016 has average of $37,000 student loan.

## Problem statement and background

- Less studies focus on the effects of the level of students loans debt has on studentsâ€™ post-graduation decision-making

- We hypothesize that high levels of student loan debt have negative effects on employment outcomes for recent graduates

## Research design and approach

- Dataset: National Survey of College Graduates (NSCG)

- Goals
1. Data visualization: to test any trends or relationships between variables of interest
2. Machine learning: to find the best predictor for the overall job satisfaction

## Methods / tools

- Data Visualization 
1. recode variables
2. create new indicators
3. group variables 
- Machine Learning 



## Slide with Plot

```{r pressure}
plot(pressure)
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
# Load Packages
library(haven)
library(tidyverse)
library(caret)
library(recipes)
library(pdp)
library(skimr)
library(foreach)
library(pastecs)
```

```{r, include=FALSE}
## Data Wrangling - Won't be included in the knit pdf output.
## filtering by age, selecting variables of interest, creating key indicators
epcg17 <- read_dta("epcg17.dta")
epcg17_new <-  epcg17 %>% 
  filter(., age<36 & bast=="099" & bayr>1975 & ugloanr!="01" & emrg<10) %>% 
  # selecting age, race, gender, undergraduate loan amoutn, graduate loan amount, physical disability indicator
  select(age, racethm, ugloanr, gender, grloanr, hcapin,
         #degree information, second to fifth highest degrees, highest degree, most recent degree
         d2dg, d3dg, d4dg, d5dg, dgrdg, mrdg,
         #primary/secondary work activity, public/private status of undergrad institution, year ba received
         actcap:acttch, bapbpr, bayr,
         # reason for changing employer
         chchg:chloc, chot:chsch,
         # visa type for non-US citizen, year highest degree awarded, father and mother's education level
         ctzfor, dgryr, eddad, edmom,
         #region code for employer, employer type, employer size, detailed employer sector, 
         emrg, emtp, emsize, emsecdt, emsecsm, facadv:facsoc,
         # hours per week worked, job benefits, job satisfaction, labor force status, looking for work, marital status
         hrswk, jobins:jobproft, jobvac, jobsatis, lfstat, lookwk, marsta,
         # job code for last job, job code for principal job, field of study of BA degree, employer type
         n2ocmlst, n2ocprmg, nbamed, nedtp,
         # reasons for working outside field of highest degree, most important reason for working outside field
         nrchg:nrpay, nrrea,
         # reasons for not working, extent job is related to highest degree, reason worked part-time
         nwfam:nwstu, ocedrlp, pjfam:pjstu,
         # respondent location, salary, satisfaction in prinicipal job for..., spouse working indicator, year principal job started
         resploc, salary, satadv:satsoc, spowk, strtyr,
         # amount still owed from undergrad loan, amount still owed from grad loan, veteran status 
         ugower, grower, vetstat) %>% 
  # creating gender and race indicators
  mutate(., female = ifelse(gender=="F", 1,0)) %>% 
  mutate(., race_white = ifelse(racethm=="5",1,0 )) %>% 
  mutate(., race_black = ifelse(racethm=="3",1,0 )) %>% 
  mutate(., race_hispanic = ifelse(racethm=="4",1,0 )) %>%
  mutate(., race_asian = ifelse(racethm=="1",1,0 )) %>%
  mutate(., race_other = ifelse(racethm=="2" | racethm=="6" | racethm=="7", 1,0)) %>% 
  # replacing 9999998 to NA for salary variable
  mutate(., salary= ifelse(salary==9999998, NA, salary)) %>% 
  # bachelor degree indicator
  mutate(., bachelor_degree= ifelse(mrdg=="1", 1,
                                    ifelse(dgrdg=="1", 1,
                                           ifelse(d2dg=="1", 1,
                                                  ifelse(d3dg=="1", 1,
                                                         ifelse(d4dg=="1",1,
                                                                ifelse(d5dg=="1", 1, 0))))))) %>%
  # master's degree indicator
  mutate(., master_degree= ifelse(mrdg=="2", 1,
                                    ifelse(dgrdg=="2", 1,
                                           ifelse(d2dg=="2", 1,
                                                  ifelse(d3dg=="2", 1,
                                                         ifelse(d4dg=="2",1,
                                                                ifelse(d5dg=="2", 1, 0))))))) %>%
  mutate(., doctorate_degree= ifelse(mrdg=="3", 1,
                                    ifelse(dgrdg=="3", 1,
                                           ifelse(d2dg=="3", 1,
                                                  ifelse(d3dg=="3", 1,
                                                         ifelse(d4dg=="3",1,
                                                                ifelse(d5dg=="3", 1, 0))))))) %>%
  # professional degree
  mutate(., professional_degree= ifelse(mrdg=="4", 1,
                                    ifelse(dgrdg=="4", 1,
                                           ifelse(d2dg=="4", 1,
                                                  ifelse(d3dg=="4", 1,
                                                         ifelse(d4dg=="4",1,
                                                                ifelse(d5dg=="4", 1, 0))))))) %>%
  mutate(.,satadv_satisfied = if_else(satadv=="1" | satadv =="2", 1, 0)) %>% 
  mutate(.,satben_satisfied = if_else(satben=="1" | satben =="2", 1, 0)) %>%
  mutate(.,satsal_satisfied = if_else(satsal=="1" | satsal =="2", 1, 0)) %>%
  mutate(.,satsec_satisfied = if_else(satsec=="1" | satsec =="2", 1, 0)) %>%
  mutate(.,satresp_satisfied = if_else(satresp=="1" | satresp =="2", 1, 0)) %>% 
  mutate(.,job_satisfied = if_else(jobsatis=="1" | jobsatis =="2", 1, 0))
head(epcg17_new)
table(epcg17_new$ugloanr)
```

```{r}
# Plots
library(ggplot2)
# visual 1
# Data set for visual 1
dataforplot1 <- epcg17_new %>%
  filter(., jobsatis!="L") %>% 
  mutate(., racethm_new = ifelse(racethm == 5, "White",
                                 ifelse(racethm == 2 | racethm > 5, "Other",
                                        ifelse(racethm == 1, "Asian",
                                               ifelse(racethm==3, "Black", "Hispanic"))))) %>% 
  mutate(.,emrg_char=ifelse(emrg=="01","New England",
                            ifelse(emrg=="02", "Middle Atlantic",
                                   ifelse(emrg=="03", "East North Central",
                                          ifelse(emrg=="04", "West North Central",
                                                 ifelse(emrg=="05", "South Central",
                                                        ifelse(emrg=="06", "East South Central",
                                                               ifelse(emrg=="07", "West South Central",
                                                                      ifelse(emrg=="08", "Mountain", "Pacific and US Territories"))))))))) %>% 
  mutate(.,emrg_factor=factor(emrg_char, c("New England", "Middle Atlantic", "East North Central", "West North Central",
                                            "South Central", "East South Central", "West South Central",
                                            "Mountain", "Pacific and US Territories"))) %>% 
  mutate(.,racethm_factor=factor(racethm_new, c("White", "Black", "Hispanic", "Asian", "Other")))
# ggplot code for Visual 1
ggplot(data=dataforplot1) +
  geom_density(aes(x=as.numeric(ugloanr), fill=racethm_factor), alpha=0.4, position = "fill") +
  facet_wrap(~emrg_factor) +
  scale_x_continuous(name ="Undergraduate Loan Amounts", 
                     breaks = c(2:12),
                     labels = c("$0", "", "", "", "", "$40,001-50,000", "", "", "", "", "More than $90,000" ))+
  labs(title ="Figure 1. Undergraud Loan Borrowing Trend by Employer Region and Respondent's Race",
       caption = "Data: National Survey of College Graduates") +
   scale_fill_brewer(name="Race/Ethnicity",
                    type="qual",
                    palette="Accent") +
  theme(axis.title.y = element_blank(),
        panel.background = element_blank(),
        strip.background = element_blank(),
        panel.grid.major.x =element_line(colour = "grey", size = 0.5),
        axis.text.x = element_text(face="bold", 
                                   size=8, angle=25))
```









## Slide with R Output

```{r cars, echo = TRUE}
summary(cars)
```


